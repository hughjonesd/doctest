<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="doctest">
<title>doctest • doctest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="doctest">
<meta property="og:description" content="doctest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">doctest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/doctest.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/conversion.html">Converting a package to use doctest</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hughjonesd/doctest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>doctest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hughjonesd/doctest/blob/HEAD/vignettes/doctest.Rmd" class="external-link"><code>vignettes/doctest.Rmd</code></a></small>
      <div class="d-none name"><code>doctest.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-doctest">Introduction to doctest<a class="anchor" aria-label="anchor" href="#introduction-to-doctest"></a>
</h2>
<p>Documentation examples and tests are similar in some ways:</p>
<ul>
<li><p>They are self-contained pieces of code.</p></li>
<li><p>They should cover the software’s most important functions and
typical uses.</p></li>
<li><p>They should be simple and clear: complex examples are hard for
users to understand, and complex test code can introduce testing
bugs.</p></li>
</ul>
<p>This similarity makes it attractive to use “doctests”, which combine
tests and documentation. Indeed, several languages, including Python and
Rust, have doctests built in.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://docs.python.org/3/library/doctest.html" class="external-link uri"&gt;https://docs.python.org/3/library/doctest.html&lt;/a&gt;, &lt;a href="https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html" class="external-link uri"&gt;https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> R also checks for errors in examples when
running <code>R CMD check</code>.</p>
<p>The doctest package extends this idea. It lets you write <a href="https://testthat.r-lib.org/" class="external-link">testthat</a> tests, by adding tags to
your <a href="https://roxygen2.r-lib.org/" class="external-link">roxygen</a> documentation.
This helps you check that your examples do what they are supposed to
do.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here’s some <a href="https://roxygen2.r-lib.org" class="external-link">roxygen</a>
documentation for a function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Fibonacci function </span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param n Integer</span></span>
<span><span class="co">#' @return The nth Fibonacci number</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @doctest</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @expect type("integer")</span></span>
<span><span class="co">#' fib(2)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' n &lt;- 6 </span></span>
<span><span class="co">#' @expect equal(8)</span></span>
<span><span class="co">#' fib(n)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @expect warning("not numeric")</span></span>
<span><span class="co">#' fib("a")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @expect warning("NA")</span></span>
<span><span class="co">#' fib(NA)</span></span>
<span><span class="va">fib</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"n is not numeric"</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Instead of an <code>@examples</code> section, we have a
<code>@doctest</code> section.</p>
<p>This will create tests like:</p>
<pre><code><span><span class="co"># Generated by doctest: do not edit by hand</span></span>
<span><span class="co"># Please edit file in R/&lt;text&gt;</span></span>
<span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"Doctest: fib"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Created from @doctest for `fib`</span></span>
<span>  <span class="co"># Source file: &lt;text&gt;</span></span>
<span>  <span class="co"># Source line: 7</span></span>
<span>  <span class="fu">expect_type</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="st">"integer"</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="fu">expect_warning</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span>, <span class="st">"not numeric"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_warning</span><span class="op">(</span><span class="fu">fib</span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
<p>The .Rd file will be created as normal, with an example section
like:</p>
<pre><code>\examples{
fib(2)

n &lt;- 6 
fib(n)
fib("a")
fib(NA)
}</code></pre>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>You can install the development version of doctest like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"hughjonesd/doctest"</span><span class="op">)</span></span></code></pre></div>
<p>To use doctest in your package, alter its DESCRIPTION file to add the
<code>dt_roclet</code> roclet to roxygen:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Roxygen</span><span class="op">:</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>roclets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"collate"</span>, <span class="st">"rd"</span>, <span class="st">"namespace"</span>, </span>
<span>              <span class="st">"doctest::dt_roclet"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Then use <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenize()</a></code> or
<code>devtools::document()</code> to build your package
documentation.</p>
</div>
<div class="section level3">
<h3 id="adding-doctests-to-your-package">Adding doctests to your package<a class="anchor" aria-label="anchor" href="#adding-doctests-to-your-package"></a>
</h3>
<p>Here’s a simple workflow to start using doctest:</p>
<ol style="list-style-type: decimal">
<li><p>Alter your package DESCRIPTION as above.</p></li>
<li><p>In your roxygen documentation, replace <code>@examples</code> by
<code>@doctest</code>.</p></li>
<li><p>In the package directory run <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenize()</a></code>
or <code>devtools::document()</code> to create documentation. You should
see Rd files created as normal in the <code>man/</code> directory,
including <code>\examples</code> sections.</p></li>
<li><p>Add <code>@expect</code> tags to your <code>@doctest</code>
sections.</p></li>
<li><p>Run <code>roxygenize()</code> again. You will now see new files
created in the <code>tests/testthat</code> directory, with the name
<code>test-doctest-&lt;topic name&gt;.R</code>.</p></li>
<li><p>Run <code>devtools::test()</code> and check that your tests
pass.</p></li>
</ol>
<p>At present, you can’t use doctest from the RStudio keyboard shortcut
<code>Ctrl + Shift + D</code>, because this always uses the standard
roxygen2 roclets. However, you can bind the RStudio addin “Devtools:
document a package” to a keyboard shortcut. This will use the roclets
from your package DESCRIPTION file.</p>
<p>You don’t need to add doctest as a dependency to your package. Just
like roxygen2 itself, you can use it to create help files and tests
without it being installed for users. However, you may wish to add it in
<code>Suggests:</code>, to help other developers working on the
package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_dev_package</span><span class="op">(</span><span class="st">"doctest"</span>, type <span class="op">=</span> <span class="st">"Suggests"</span>, </span>
<span>                         remote <span class="op">=</span> <span class="st">"hughjonesd/doctest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tags">Tags<a class="anchor" aria-label="anchor" href="#tags"></a>
</h3>
<p>The doctest package adds these tags to roxygen:</p>
<div class="section level4">
<h4 id="doctest">
<code>@doctest</code><a class="anchor" aria-label="anchor" href="#doctest"></a>
</h4>
<p>Use <code>@doctest</code> instead of <code>@examples</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @doctest</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' # ... examples for your function</span></span></code></pre></div>
<p>The content of <code>@doctest</code> will be used in the .Rd
“examples” section, and in a testthat test.</p>
<p>You can have more than one <code>@doctest</code> section. Each
section creates one test like
<code>test_that("Test name", {...})</code>. You can name the doctest, or
leave it blank for a default name. All the sections will be merged into
a single .Rd example.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @doctest Positive numbers</span></span>
<span><span class="co">#' x &lt;- 1</span></span>
<span><span class="co">#' @expect equal(x)</span></span>
<span><span class="co">#' abs(x)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @doctest Negative numbers</span></span>
<span><span class="co">#' x &lt;- -1</span></span>
<span><span class="co">#' @expect equal(-x)</span></span>
<span><span class="co">#' abs(x)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="expect">
<code>@expect</code><a class="anchor" aria-label="anchor" href="#expect"></a>
</h4>
<p><code>@expect</code> writes a testthat expectation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @expect equal(4)</span></span>
<span><span class="co">#' 2 + 2</span></span></code></pre></div>
<p>You can use any <code>expect_*</code> function from
<code>testthat</code>. Omit the <code>expect_</code> at the start of the
call.</p>
<p>The expression on the next line will be substituted as the first
argument into the <code>expect</code> call:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">expect_equal</span><span class="op">(</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>Use a dot <code>.</code> to substitute in different places:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @expect equal(., rev(.))</span></span>
<span><span class="co">#' c("T", "E", "N", "E", "T")</span></span></code></pre></div>
<p>This becomes:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"E"</span>, <span class="st">"N"</span>, <span class="st">"E"</span>, <span class="st">"T"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"E"</span>, <span class="st">"N"</span>, <span class="st">"E"</span>, <span class="st">"T"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="expectraw">
<code>@expectRaw</code><a class="anchor" aria-label="anchor" href="#expectraw"></a>
</h4>
<p><code>@expectRaw</code> writes an expectation, without substituting
the next expression:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' x &lt;- 2 + 2</span></span>
<span><span class="co">#' @expectRaw equal(x, 4)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="snap">
<code>@snap</code><a class="anchor" aria-label="anchor" href="#snap"></a>
</h4>
<p><code>@snap</code> is shorthand for <code>@expect snapshot()</code>.
This creates a <a href="https://testthat.r-lib.org/articles/snapshotting.html" class="external-link">snapshot
test</a>, which is useful for checking that complex examples haven’t
changed.</p>
</div>
<div class="section level4">
<h4 id="testraw">
<code>@testRaw</code><a class="anchor" aria-label="anchor" href="#testraw"></a>
</h4>
<p><code>@testRaw</code> adds an arbitrary line of code to your
test:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @testRaw skip_on_cran("Takes too long to run")</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @expect equal(6765)</span></span>
<span><span class="co">#' fib(20)</span></span></code></pre></div>
<p>Tests are only written if they contain at least one
<code>@expect</code> or <code>@expectRaw</code> tag, so use those tags
to create expectations, not <code>@testRaw</code>.</p>
</div>
<div class="section level4">
<h4 id="omit-and-resume">
<code>@omit</code> and <code>@resume</code><a class="anchor" aria-label="anchor" href="#omit-and-resume"></a>
</h4>
<p>While <code>@testRaw</code> includes a line of code in the test but
not the example, <code>@omit</code> does the opposite: it includes all
following code in the example but not the test. You can use
<code>@resume</code> to restart including lines without creating a new
expectation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' myfunc(1)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @omit</span></span>
<span><span class="co">#' # No need to test plotting</span></span>
<span><span class="co">#' plot(1:10, my_func(1:10))</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @resume</span></span>
<span><span class="co">#' x &lt;- NA</span></span>
<span><span class="co">#' @expect warning()</span></span>
<span><span class="co">#' myfunc(x)</span></span></code></pre></div>
<p>If you are using <code>@testRaw</code> and <code>@omit</code> a lot,
it is probably a good idea to separate out the test and the example. You
can do this by renaming the <code>test-doctest-</code> file, and
removing the “Generated by doctest” line within it. Then change your
<code>@doctest</code> tag back to <code>@examples</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h3>
<ul>
<li><p>Don’t use <code>@doctest</code> and <code>@examples</code> in the
same topic. That won’t work.</p></li>
<li><p>Doctest currently ignores <code>\dontrun</code> and
<code>\donttest</code> macros. Potentially, that could lead to dangerous
code being included in tests. To avoid this, use the <code>@omit</code>
tag.</p></li>
<li><p>Each <code>@doctest</code> section should include a complete
self-contained example, that would work inside a <code>test_that</code>
expression. Don’t rely on variables from a previous
<code>@doctest</code>.</p></li>
<li><p>You can include expectations within e.g. <code>if</code> blocks
or <code>for</code> loops. Don’t forget that each roxygen tag must be
indented with a single space:</p></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' # Right:</span></span>
<span><span class="co">#' if (TRUE) {</span></span>
<span><span class="co">#' @expect equals(4)</span></span>
<span><span class="co">#'   2+2</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' # Wrong:</span></span>
<span><span class="co">#' if (TRUE) {</span></span>
<span><span class="co">#'   @expect equals(4)</span></span>
<span><span class="co">#'   2+2</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="writing-good-doctests">Writing good doctests<a class="anchor" aria-label="anchor" href="#writing-good-doctests"></a>
</h3>
<p>Tests and documentation are similar, but not identical. Tests need to
cover difficult corner cases. Examples need to convey the basics to the
user. I like the following advice:</p>
<blockquote>
<p>… write the best possible documentation, and [R] makes sure the code
samples in your documentation actually compile and run [and do what they
are supposed to do]</p>
</blockquote>
<p><em>Programming Rust</em>, Blandy, Orendorff and Tindall, 2021</p>
<p>In particular, use doctest as an <em>addition</em> to manually
created tests, not a <em>substitute</em> for them. Use doctest to make
sure your examples do what they expect, and for simple tests of basic
functionality. If it’s hard to specify what to test for, consider using
<code>@snap</code> to capture output:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @snap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>For more complex test cases, write a test file manually.</p>
<p>To see an example of using the doctest package in “production”, check
out <code><a href="../articles/conversion.html">vignette("conversion")</a></code>.</p>
</div>
<div class="section level3">
<h3 id="related-packages">Related packages<a class="anchor" aria-label="anchor" href="#related-packages"></a>
</h3>
<p>The <a href="https://mikldk.github.io/roxytest/" class="external-link">roxytest</a> and <a href="https://github.com/bryanhanson/roxut" class="external-link">roxut</a> packages both
allow you to write tests in roxygen blocks. Doctest is slightly
different because it combines tests with examples. The <a href="https://github.com/rorynolan/exampletestr/" class="external-link">exampletestr</a>
package uses roxygen examples to generate a test skeleton which you can
fill in yourself.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
