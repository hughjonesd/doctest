# Doctest

Documentation examples and tests are similar in some ways:

- They are self-contained pieces of code.

- They should cover the software’s most important functions and typical
  uses.

- They should be simple and clear: complex examples are hard for users
  to understand, and complex test code can introduce testing bugs.

This similarity makes it attractive to use “doctests”, which combine
tests and documentation. Indeed, several languages, including Python and
Rust, have doctests built in.\[1\] R also checks for errors in examples
when running `R CMD check`.

The doctest package extends this idea. It lets you write
[testthat](https://testthat.r-lib.org/) tests, by adding tags to your
[roxygen](https://roxygen2.r-lib.org/) documentation. This helps you
check that your examples do what they are supposed to do.

## Example

Here’s some [roxygen](https://roxygen2.r-lib.org) documentation for a
function:

``` r

#' Fibonacci function 
#' 
#' @param n Integer
#' @return The nth Fibonacci number
#' 
#' @doctest
#'
#' @expect type("integer")
#' fib(2)
#'
#' n <- 6 
#' @expect equal(8)
#' fib(n)
#' 
#' @expect warning("not numeric")
#' fib("a")
#'
#' @expect warning("NA")
#' fib(NA)
fib <- function (n) {
  if (! is.numeric(n)) warning("n is not numeric")
  ...
}
```

Instead of an `@examples` section, we have a `@doctest` section.

This will create tests like:

``` R
# Generated by doctest: do not edit by hand
# Please edit file in R/<text>

test_that("Doctest: fib", {
  # Created from @doctest for `fib`
  # Source file: <text>
  expect_type(fib(2), "integer")
  n <- 6
  expect_equal(fib(n), 8)
  expect_warning(fib("a"), "not numeric")
  expect_warning(fib(NA), "NA")
})
```

The .Rd file will be created as normal, with an example section like:

``` R
\examples{
fib(2)

n <- 6 
fib(n)
fib("a")
fib(NA)
}
```

## Usage

Install doctest from [r-universe](https://r-universe.dev):

``` r
install.packages("doctest", repos = c("https://hughjonesd.r-universe.dev", 
                                      "https://cloud.r-project.org"))
```

Or from CRAN:

``` r
install.packages("doctest")
```

Or get the development version:

``` r
devtools::install("hughjonesd/doctest")
```

To use doctest in your package, alter its DESCRIPTION file to add the
`dt_roclet` roclet to roxygen:

``` r
Roxygen: list(roclets = c("collate", "rd", "namespace", 
              "doctest::dt_roclet")) 
```

Then use
[`roxygen2::roxygenize()`](https://roxygen2.r-lib.org/reference/roxygenize.html)
or `devtools::document()` to build your package documentation.

For more information, see the [package
vignette](https://hughjonesd.github.io/doctest/articles/doctest.html).

1.  <https://docs.python.org/3/library/doctest.html>,
    <https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html>

# Package index

## Package overview

- [`doctest`](https://hughjonesd.github.io/doctest/reference/doctest-package.md)
  [`doctest-package`](https://hughjonesd.github.io/doctest/reference/doctest-package.md)
  : Write testthat tests for your examples, using roxygen tags

## Tags

- [`doctest-tag`](https://hughjonesd.github.io/doctest/reference/doctest-tag.md)
  [`@doctest`](https://hughjonesd.github.io/doctest/reference/doctest-tag.md)
  : Start a doctest
- [`doctestExample-tag`](https://hughjonesd.github.io/doctest/reference/doctestExample-tag.md)
  [`@doctestExample`](https://hughjonesd.github.io/doctest/reference/doctestExample-tag.md)
  : Add an example from a file
- [`expect-tag`](https://hughjonesd.github.io/doctest/reference/expect-tag.md)
  [`@expect`](https://hughjonesd.github.io/doctest/reference/expect-tag.md)
  : Create an expectation
- [`expectRaw-tag`](https://hughjonesd.github.io/doctest/reference/expectRaw-tag.md)
  [`@expectRaw`](https://hughjonesd.github.io/doctest/reference/expectRaw-tag.md)
  : Create an expectation as-is
- [`omit-tag`](https://hughjonesd.github.io/doctest/reference/omit-tag.md)
  [`resume-tag`](https://hughjonesd.github.io/doctest/reference/omit-tag.md)
  [`@omit`](https://hughjonesd.github.io/doctest/reference/omit-tag.md)
  [`@resume`](https://hughjonesd.github.io/doctest/reference/omit-tag.md)
  : Exclude example code from a test
- [`snap-tag`](https://hughjonesd.github.io/doctest/reference/snap-tag.md)
  [`@snap`](https://hughjonesd.github.io/doctest/reference/snap-tag.md)
  : Create a snapshot test
- [`testRaw-tag`](https://hughjonesd.github.io/doctest/reference/testRaw-tag.md)
  [`@testRaw`](https://hughjonesd.github.io/doctest/reference/testRaw-tag.md)
  : Add a line of code to the test

## Functions

- [`dt_roclet()`](https://hughjonesd.github.io/doctest/reference/dt_roclet.md)
  : Create the doctest roclet
- [`test_doctests()`](https://hughjonesd.github.io/doctest/reference/test_doctests.md)
  : Test doctests in a package

# Articles

### All vignettes

- [Converting a package to use
  doctest](https://hughjonesd.github.io/doctest/articles/conversion.md):
- [doctest](https://hughjonesd.github.io/doctest/articles/doctest.md):
