# Write testthat tests for your examples, using roxygen tags

The doctest package lets you test the code in your "Examples" section in
.Rd files. It uses the roxygen2 and testthat packages. For more
information, see
[@doctest](https://hughjonesd.github.io/doctest/reference/doctest-tag.md)
and
[@expect](https://hughjonesd.github.io/doctest/reference/expect-tag.md).

## Details

### Example

Here's some [roxygen](https://roxygen2.r-lib.org) documentation for a
function:

    #' Fibonacci function
    #'
    #' @param n Integer
    #' @return The nth Fibonacci number
    #'
    #' @doctest
    #'
    #' @expect type("integer")
    #' fib(2)
    #'
    #' n <- 6
    #' @expect equal(8)
    #' fib(n)
    #'
    #' @expect warning("not numeric")
    #' fib("a")
    #'
    #' @expect warning("NA")
    #' fib(NA)
    fib <- function (n) {
      if (! is.numeric(n)) warning("n is not numeric")
      ...
    }

Instead of an `@examples` section, we have a `@doctest` section.

This will create tests like:

    # Generated by doctest: do not edit by hand
    # Please edit file in R/<text>

    test_that("Doctest: fib", {
      # Created from @doctest for `fib`
      # Source file: <text>
      expect_type(fib(2), "integer")
      n <- 6
      expect_equal(fib(n), 8)
      expect_warning(fib("a"), "not numeric")
      expect_warning(fib(NA), "NA")
    })

The .Rd file will be created as normal, with an example section like:

    \examples{
    fib(2)

    n <- 6
    fib(n)
    fib("a")
    fib(NA)
    }

### Usage

Install doctest from [r-universe](https://r-universe.dev):

    install.packages("doctest", repos = c("https://hughjonesd.r-universe.dev",
                                          "https://cloud.r-project.org"))

Or from CRAN:

    install.packages("doctest")

Or get the development version:

    devtools::install("hughjonesd/doctest")

To use doctest in your package, alter its DESCRIPTION file to add the
`dt_roclet` roclet and `"doctest"` package to roxygen:

    Roxygen: list(roclets = c("collate", "rd", "namespace",
                  "doctest::dt_roclet"), packages = "doctest")

Then use
[`roxygen2::roxygenize()`](https://roxygen2.r-lib.org/reference/roxygenize.html)
or `devtools::document()` to build your package documentation.

Doctest is **\[experimental\]**.

## See also

Useful links:

- <https://hughjonesd.github.io/doctest/>

- Report bugs at <https://github.com/hughjonesd/doctest/issues>

## Author

**Maintainer**: David Hugh-Jones <davidhughjones@gmail.com>
