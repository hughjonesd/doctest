
<!-- README.md is generated from README.Rmd. Please edit that file -->

# Doctest

<!-- badges: start -->

[![R-CMD-check](https://github.com/hughjonesd/doctest/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/hughjonesd/doctest/actions/workflows/R-CMD-check.yaml)
[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

## Introduction

Documentation examples and tests are similar in some ways:

- They are self-contained pieces of code.

- They should cover the software’s most important functions and typical
  uses.

- They should be simple and clear: complex examples are hard for users
  to understand, and complex test code can introduce testing bugs.

This similarity makes it attractive to use “doctests”, which combine
tests and documentation. Indeed, several languages, including Python and
Rust, have doctests built in.[^1] R also checks for errors in examples
when running `R CMD check`.

The doctest package extends this idea. It lets you write
[testthat](https://testthat.r-lib.org/) tests, by adding tags to your
[roxygen](https://roxygen2.r-lib.org/) documentation. This helps you
check that your examples do what they are supposed to do.

## Example

Here’s some [roxygen](https://roxygen2.r-lib.org) documentation for a
function:

``` r

#' Safe mean
#' 
#' @param x Numeric vector
#' @return The mean of `x`
#' 
#' @doctest
#' @expect equal(2)
#' safe_mean(1:3)
#' 
#' @expect warning("not numeric")
#' safe_mean("a")
#'
#' @expect warning("NA elements")
#' safe_mean(c(1, NA))
safe_mean <- function (x) {
  if (! is.numeric(x)) warning("x is not numeric")
  if (any(is.na(x))) warning("x contains NA elements")
  mean(x)
}
```

Instead of an `@examples` section, we have a `@doctest` section.

This will create tests like:

    # Generated by doctest: do not edit by hand
    # Please edit file in R/<text>

    test_that("Example: safe_mean", {
      # Created from @doctest for `safe_mean`
      # Source file: <text>
      # Source line: 7
      expect_equal(safe_mean(1:3), 2)
      expect_warning(safe_mean("a"), "not numeric")
      expect_warning(safe_mean(c(1, NA)), "NA elements")
    })

The .Rd file will be created as normal, with an example section like:

    \examples{
    safe_mean(1:3)
    safe_mean("a")
    safe_mean(c(1, NA))
    }

## Usage

You can install the development version of doctest like this:

``` r
devtools::install("hughjonesd/doctest")
```

For more information, see the [package
vignette](https://hughjonesd.github.io/doctest/docs/articles/doctest.html).

[^1]: <https://docs.python.org/3/library/doctest.html>,
    <https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html>
