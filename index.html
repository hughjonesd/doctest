<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Creates testthat tests from roxygen examples using simple tags.">
<title>Generate Tests From Examples Using roxygen and testthat • doctest</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Generate Tests From Examples Using roxygen and testthat">
<meta property="og:description" content="Creates testthat tests from roxygen examples using simple tags.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">doctest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="doctest">doctest<a class="anchor" aria-label="anchor" href="#doctest"></a>
</h1></div>
<!-- badges: start -->

<p>Documentation examples and tests share certain features. They are both usually self-contained pieces of code. They should cover the software’s most important functions and typical uses. They should both be simple and clear: complex examples are hard for users to understand, and complex test code can introduce testing bugs. This similarity makes it attractive to use “doctests”, which provide both documentation and testing. Indeed, several languages, including Python and Rust, have doctests built in.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://docs.python.org/3/library/doctest.html" class="external-link uri"&gt;https://docs.python.org/3/library/doctest.html&lt;/a&gt;, &lt;a href="https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html" class="external-link uri"&gt;https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> R also checks for errors in examples when running <code>R CMD check</code>.</p>
<p>The doctest package extends this idea. It lets you write <a href="https://testthat.r-lib.org/" class="external-link">testthat</a> tests, by adding tags to your <a href="https://roxygen2.r-lib.org/" class="external-link">roxygen</a> documentation. So, as well as checking that your examples run, you can also check they do what they are supposed to do.</p>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Here’s some documentation for a function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Safe mean</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param x Numeric vector</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' x &lt;- safe_mean(1:3)</span></span>
<span><span class="co">#' @expect equal(x, 2)</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @expect warning(., "not numeric")</span></span>
<span><span class="co">#' safe_mean("a")</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @expect warning(., "NA elements")</span></span>
<span><span class="co">#' safe_mean(c(1, NA))</span></span>
<span><span class="va">safe_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"x is not numeric"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="st">"x contains NA elements"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This will create tests like:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # File test-examples-safe_mean.R</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Generated by doctest: do not edit by hand</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; test_that("Example: safe_mean", {</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Created from @examples for `safe_mean`</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Source file: '&lt;text&gt;'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Source line: 7</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x &lt;- safe_mean(1:3)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expect_equal(x, 2)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expect_warning(safe_mean("a"), "not numeric")</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   expect_warning(safe_mean(c(1, NA)), "NA elements")</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; })</span></span></code></pre></div>
<p>The .Rd file will be created as normal, with an example section like:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; \examples{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; x &lt;- safe_mean(1:3)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; safe_mean("a")</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; safe_mean(c(1, NA))</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>You can install the development version of doctest like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"hughjonesd/doctest"</span><span class="op">)</span></span></code></pre></div>
<p>To use doctest, alter your package DESCRIPTION to add the <code>doctest</code> roclet to roxygen, like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Roxygen<span class="sc">:</span> <span class="fu">list</span>(<span class="at">roclets =</span> <span class="fu">c</span>(<span class="st">"collate"</span>, <span class="st">"rd"</span>, <span class="st">"namespace"</span>, <span class="st">"doctest::doctest"</span>)) </span></code></pre></div>
<p>You can also add <code>doctest</code> as a dependency:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_dev_package</span><span class="op">(</span><span class="st">"doctest"</span>, type <span class="op">=</span> <span class="st">"Suggests"</span>, </span>
<span>                         remote <span class="op">=</span> <span class="st">"hughjonesd/doctest"</span><span class="op">)</span></span></code></pre></div>
<p>Then in the package directory run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">roxygen2</span><span class="fu">::</span><span class="fu"><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygenize</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>as normal to create documentation. This will also create tests in <code>tests/testthat</code>, named <code>test-example-xxx.R</code>. One file is created for each example.</p>
<p>At present, you can’t use doctest from the RStudio keyboard shortcut <code>Ctrl + Shift + D</code>, because this always uses the standard roxygen2 roclets. However, you can bind the RStudio addin “Devtools: document a package” to a keyboard shortcut. This will use the roclets from your package DESCRIPTION file.</p>
</div>
<div class="section level2">
<h2 id="doctest-tags">doctest tags<a class="anchor" aria-label="anchor" href="#doctest-tags"></a>
</h2>
<p>The doctest package adds five tags to roxygen:</p>
<div class="section level3">
<h3 id="expect">
<code>@expect</code><a class="anchor" aria-label="anchor" href="#expect"></a>
</h3>
<p><code>@expect</code> writes a testthat expectation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#'</span></span>
<span><span class="co">#' @expect equal(1 + 1, 2)</span></span></code></pre></div>
<p>You can use any <code>expect_*</code> function from <code>testthat</code>. Omit the <code>expect_</code> at the start.</p>
<p>Use a dot <code>.</code> to substitute for the expression below:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @expect equal(., 4)</span></span>
<span><span class="co">#' 2+2</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @expect equal(., rev(.))</span></span>
<span><span class="co">#' c("T", "E", "N", "E", "T")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test">
<code>@test</code><a class="anchor" aria-label="anchor" href="#test"></a>
</h3>
<p>By default, all expectations are created in a single test, named after the example. <code>@test &lt;test-name&gt;</code> changes to a new test.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @test Negative numbers</span></span>
<span><span class="co">#' @expect gt(., 0)</span></span>
<span><span class="co">#' abs(-1)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="skiptest-and-resumetest">
<code>@skipTest</code> and <code>@resumeTest</code>
<a class="anchor" aria-label="anchor" href="#skiptest-and-resumetest"></a>
</h3>
<p>By default, the test uses the whole example, since example code may depend on previous code.</p>
<p><code>@skipTest</code> omits lines of the example from the test. <code>@resumeTest</code> stops omitting lines. You can use this to skip irrelevant material.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @skipTest</span></span>
<span><span class="co">#' # No need to test plotting</span></span>
<span><span class="co">#' plot(1:10, my_func(1:10))</span></span>
<span><span class="co">#' @resumeTest</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testcomments">
<code>@testComments</code><a class="anchor" aria-label="anchor" href="#testcomments"></a>
</h3>
<p>Because of how roxygen works, you can’t add expectations in the middle of complex expressions like <code>if</code> statements or <code>for</code> loops. For example, this won’t work:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' if (x &gt; 0) {</span></span>
<span><span class="co">#'   @expect gt(x, 0)</span></span>
<span><span class="co">#' } else {</span></span>
<span><span class="co">#'   @expect lt(x, 0)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<p>As an alternative, you can use the <code>@testComments</code> tag to test expectations in comments:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @testComments</span></span>
<span><span class="co">#' if (x &gt; 0) {</span></span>
<span><span class="co">#'   # expect gt(x, 0)</span></span>
<span><span class="co">#' } else {</span></span>
<span><span class="co">#'   # expect lt(x, 0)</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<p>Doctest comments follow the same format as the expectation tag, but with <code>@expect</code> replaced by <code># expect</code>. Comments must be on their own line, and will remain in the example code.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-use-doctest">How to use doctest<a class="anchor" aria-label="anchor" href="#how-to-use-doctest"></a>
</h2>
<p>doctest is best used for relatively simple tests. If things get too complex it may be better to write a test yourself. I like the following advice:</p>
<blockquote>
<p>… write the best possible documentation, and [R] makes sure the code samples in your documentation actually compile and run [and do what they are supposed to do]</p>
</blockquote>
<p><em>Programming Rust</em>, Blandy, Orendorff and Tindall, 2021</p>
</div>
<div class="section level2">
<h2 id="bugs-and-limitations">Bugs and limitations<a class="anchor" aria-label="anchor" href="#bugs-and-limitations"></a>
</h2>
<div class="section level3">
<h3 id="empty-examples-section">Empty <code>@examples</code> section<a class="anchor" aria-label="anchor" href="#empty-examples-section"></a>
</h3>
<p>Roxygen may produce a warning like <code>@examples requires a value</code>. This is harmless. To avoid it, put some R code in your <code>@examples</code> section before the first <code>@expectation</code> or other tag.</p>
</div>
<div class="section level3">
<h3 id="donttest-and-dontrun">
<code>donttest</code> and <code>dontrun</code>
<a class="anchor" aria-label="anchor" href="#donttest-and-dontrun"></a>
</h3>
<p><code>donttest</code> and <code>dontrun</code> Rd tags are ignored by doctest. This lets you test code that would fail when run by R CMD CHECK. Howeer, these tags must not span more than one doctest tag. For example, this will work:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @expect error(., "argh")</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' stop("argh")</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<p>But this won’t, because it contains a doctest tag:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#' @expect error(., "argh")</span></span>
<span><span class="co">#' stop("argh")</span></span>
<span><span class="co">#' }</span></span></code></pre></div>
<p>You can work around this by using the <code>@testComments</code> tag and writing expectations as comments.</p>
</div>
</div>
<div class="section level2">
<h2 id="related-packages">Related packages<a class="anchor" aria-label="anchor" href="#related-packages"></a>
</h2>
<p>The <a href="https://mikldk.github.io/roxytest/" class="external-link">roxytest</a> and <a href="https://github.com/bryanhanson/roxut" class="external-link">roxut</a> packages both allow you to write tests in roxygen blocks. Doctest is slightly different because it combines tests with examples. The <a href="https://github.com/rorynolan/exampletestr/" class="external-link">exampletestr</a> package uses roxygen examples to generate a test skeleton which you can fill in yourself.</p>
</div>
</div>


  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing doctest</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>David Hugh-Jones <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/hughjonesd/doctest/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/hughjonesd/doctest/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
